services:
  geo-asn-auth:
    image: ghcr.io/wildetechsolutions/geo-asn-auth:latest
    # Override container user to match your host user for proper file permissions
    # Uncomment and set to your UID:GID (run `id -u` and `id -g` to find yours)
    # user: "1001:1001"
    # Or build locally with custom UID/GID baked into the image:
    # build:
    #   context: .
    #   args:
    #     USER_UID: 1000  # Match your host user (run `id -u`)
    #     USER_GID: 1000  # Match your host group (run `id -g`)
    container_name: geo-asn-auth
    restart: unless-stopped
    volumes:
      # Mount MaxMind databases (required) This can be a shared location for other Pangolin services
      - ./config/maxmind:/data:ro
      # Mount custom config (optional - uses bundled config.example.yaml if not provided)
      # Create config.yaml from config.example.yaml and uncomment to customize:
      # - ./geoblock/config.yaml:/app/config.yaml:ro
      # Mount blocklists directory for caching and custom ASN lists
      - ./geoblock/blocklists:/blocklists
    # All environment variables are optional - defaults shown below
    # Uncomment and modify only if you need to override defaults
    # environment:
      # - PORT=9876                                  # Service port (default: 9876)
      # - CONFIG_PATH=/app/config.yaml               # Config file path (default: /app/config.yaml)
      # - COUNTRY_DB_PATH=/data/GeoLite2-Country.mmdb  # Country database (default: /data/GeoLite2-Country.mmdb)
      # - ASN_DB_PATH=/data/GeoLite2-ASN.mmdb        # ASN database (default: /data/GeoLite2-ASN.mmdb)
      # - CACHE_HOURS=168                            # Blocklist cache duration in hours (default: 168 = 7 days)
      # - ALLOW_LAN=true                             # Allow private/LAN IPs (default: true)
      # - ALLOW_UNKNOWN=true                         # Allow when geo data unavailable (default: true)
      # - USE_HTML_RESPONSE=true                     # Use HTML for blocked pages (default: true, set to false for JSON)
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:9876/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
